function initialize() {
    var locations = [[49.9563,15.2797],[37.9707,23.7312],[37.6502,24.0267],[38.479,22.4947],[50.8953,4.3407],[22.1688,113.5553],[22.2792,114.1615],[39.9065,116.3915],[31.2243,121.4758],[31.237,120.4068],[32.0645,118.8483],[34.3905,109.286],[34.2778,108.934],[30.6667,104.0667],[29.5878,103.2893],[29.5878,103.2893],[26.8762,100.23],[25.0125,102.7],[24.7762,110.479],[23.127,113.3415],[34.1015,-118.3327],[36.175,-115.1372],[36.016,-114.7377],[37.9762,-119.1342],[37.6485,-118.9722],[38.952,-120.1053],[37.8555,-119.5555],[38.2918,-122.458],[37.7748,-122.4193],[37.8048,-122.4605],[37.8272,-122.4232],[43.3118,3.4705],[43.3558,3.529],[43.4017,3.6967],[57.3335,10.528],[56.2003,10.6803],[48.1742,16.9777],[46.0782,18.2238],[45.0252,14.5752],[45.8075,15.9788],[45.2282,13.5975],[46.0503,14.5055],[45.0835,13.6327],[46.3982,14.0898],[46.2637,13.841],[50.0872,14.4282],[-16.3037,-68.7648],[-16.5898,-68.853],[-15.7272,-69.7785],[-16.3955,-71.5372],[-14.6977,-75.1265],[-12.126,-77.0375],[33.7545,-84.3897],[50.7172,23.2525],[49.7823,22.7702],[49.2932,21.2758],[49.2367,19.934],[50.0485,19.938],[50.0345,19.181],[52.235,21.0188],[39.6588,-8.8252],[40.2103,-8.421],[39.362,-9.1572],[41.1407,-8.6115],[41.4413,-8.2927],[41.804,-6.75],[41.7413,-7.472],[39.4153,-7.4557],[38.571,-7.9097],[37.6388,-7.6622],[37.1018,-8.6732],[37.1018,-8.6732],[38.7098,-9.1375],[43.1173,5.803],[43.075,5.802],[43.206,5.5177],[43.5263,5.4453],[43.9493,4.8062],[55.6802,12.5883],[55.1973,10.1587],[54.9433,10.7652],[55.949,-3.1722],[41.0162,28.9702],[51.5048,-0.1275],[1.286,103.8498],[1.2947,103.8458],[3.739,115.4612],[4.3258,113.9847],[2.1967,102.2463],[6.0653,100.0432],[13.5978,103.966],[13.4413,103.8592],[11.57,104.9203],[12.4087,104.6143],[3.16,101.7105],[47.4915,19.0515],[52.5233,13.4068],[40.4145,-3.6938],[40.9523,-4.132],[59.9083,10.7505],[44.7032,8.0313],[44.1453,9.6542],[43.7222,10.3982],[43.094,11.7808],[42.7963,13.0947],[43.6198,13.5113],[45.4435,10.999],[45.4698,10.5997],[45.8135,9.0812],[37.0858,27.455],[37.0317,27.4288],[40.7503,14.4888],[40.6118,14.4037],[40.4185,15.005],[40.6672,16.6105],[42.0467,13.9233],[43.699,-7.988],[43.2694,-2.9353],[40.7578,-73.9857],[43.3228,18.9607],[49.4508,11.0782],[48.0916,8.2539],[48.0781,7.3574],[50.9414,6.9627]];

    var opt = {
        zoom: 2,
        center: new google.maps.LatLng(40.416698, -3.700354),
        mapTypeId: google.maps.MapTypeId.ROADMAP
    };
    var map = new google.maps.Map(document.getElementById("map_canvas"), opt);

    var marker, i, pos;
    for (i = 0; i < locations.length; i++) {
        marker = new google.maps.Marker({
            position: new google.maps.LatLng(locations[i][0], locations[i][1]),
            map: map
        });
        // Overwrite coords array with Marker object instead (reduce mem)
        locations[i] = marker;
    }

    // Cluster adjacent markers depending on zoom level
    var markerStyle = {url:'/images/mapmarker.png',width:20,height:20,opt_textSize:9};
    var mc = new MarkerClusterer(map, locations, { gridSize: 20, maxZoom: 4, styles: [markerStyle,markerStyle] });

    var canvasOffset = $('#map_canvas').offset().top - 5;


    $('.thumbs').masonry({
        itemSelector: 'img',
        columnWidth: 106,
        resizable: false
    })
        .children('img').click(function () {
            // Cancel any active animations
            if (marker) marker.setAnimation(null);

            // Activate new pin
            marker = locations[$(this).attr('alt')];
            marker.setAnimation(google.maps.Animation.BOUNCE);
            map.panTo(marker.getPosition());

            // Set zoom level
            if (map.getZoom() < 5 || map.getZoom() > 15)
                map.setZoom(5);

            $('html,body').animate({
                scrollTop: canvasOffset
            }, 1000);

            return false;
        });
}

google.maps.event.addDomListener(window, 'load', initialize);
